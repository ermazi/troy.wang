<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="ogg ogg全名Oracle GoldenGate，是Oracle公司用于同步数据库的工具。
1. 需求 监听源数据库MySQL/Oracle，将DML事件发送到Kafka中。
2. 方案 2.1. 使用ogg（推荐） ogg支持MySQL和Oracle，将DML同步到kafka中，提供给后端使用。
2.2. 使用canal canal是阿里开源的数据库同步/迁移工具，目前仅支持MySQL作为源数据库；对于Oracle，可以使用yugong同步到MySQL中，然后再基于canal进行binlog解析，最后同步到kafka中。
3. ogg的安装部署（MySQL） 3.1. 准备材料  下载ogg二进制包  Oracle GoldenGate for Big Data 19.1.0.0.1 on Linux x86-64 Oracle GoldenGate 19.1.0.0.3 for MySQL on Linux x86-64   centos7  ogg-mysql(10.41.253.211) ogg-target(10.41.253.212)   JDK 1.8  /usr/local/jdk    3.2. 安装测试MySQL ubuntu
# 安装 $ apt install mysql-server-5.7 -y # 简单配置 $ mysql_secure_installation # 添加binlog配置 $ grep -E &#34;^(server-id|log_bin|binlog_format)&#34; /etc/mysql/mysql."><meta property="og:title" content="ogg" />
<meta property="og:description" content="ogg ogg全名Oracle GoldenGate，是Oracle公司用于同步数据库的工具。
1. 需求 监听源数据库MySQL/Oracle，将DML事件发送到Kafka中。
2. 方案 2.1. 使用ogg（推荐） ogg支持MySQL和Oracle，将DML同步到kafka中，提供给后端使用。
2.2. 使用canal canal是阿里开源的数据库同步/迁移工具，目前仅支持MySQL作为源数据库；对于Oracle，可以使用yugong同步到MySQL中，然后再基于canal进行binlog解析，最后同步到kafka中。
3. ogg的安装部署（MySQL） 3.1. 准备材料  下载ogg二进制包  Oracle GoldenGate for Big Data 19.1.0.0.1 on Linux x86-64 Oracle GoldenGate 19.1.0.0.3 for MySQL on Linux x86-64   centos7  ogg-mysql(10.41.253.211) ogg-target(10.41.253.212)   JDK 1.8  /usr/local/jdk    3.2. 安装测试MySQL ubuntu
# 安装 $ apt install mysql-server-5.7 -y # 简单配置 $ mysql_secure_installation # 添加binlog配置 $ grep -E &#34;^(server-id|log_bin|binlog_format)&#34; /etc/mysql/mysql." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://troy.wang/docs/linux/bigdata/ogg/" />

<title>ogg | /bin/troy.wang</title>
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.6df681b0bb21155cba49f6078e3559216772d8e03e780d240c73ea21817ed5e5.css" integrity="sha256-bfaBsLshFVy6SfYHjjVZIWdy2OA&#43;eA0kDHPqIYF&#43;1eU=">
<script defer src="/en.search.min.1b7017006c9916de4474923e6953902927b00ea4079b41b69ba8a9fb9b3faa90.js" integrity="sha256-G3AXAGyZFt5EdJI&#43;aVOQKSewDqQHm0G2m6ip&#43;5s/qpA="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/"><span>/bin/troy.wang</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>











  



  
  
  
  

  
  <ul>
    
      
        <li class="book-section-flat" >
          
  
    <span>Kubernetes</span>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/docs/kubernetes/posts/argo-rollouts-support-traefik/" class="">argo-rollouts之流量管理添加traefik支持</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/kubernetes/posts/argo-rollouts/" class="">k8s灰度发布神器之argo-rollouts</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/kubernetes/posts/coredns-in-production/" class="">在kubernetes生产环境coredns</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/kubernetes/posts/run-microk8s-on-ubuntu/" class="">在ubuntu上运行microk8s</a>
  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
    <a href="/docs/linux/" class="">linux</a>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/docs/linux/basic/" class="collapsed ">linux基础知识</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/linux/monitor/" class="collapsed ">监控</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/linux/interview/" class="collapsed ">伪装者</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/linux/bigdata/" class="collapsed ">大数据</a>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/docs/linux/bigdata/kafka/" class="">kafka管理员手册</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/linux/bigdata/ogg/" class="active">ogg</a>
  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/linux/shell/" class="collapsed ">shell</a>
  

          
  
  
  

  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
    <a href="/docs/n9e/" class="">n9e</a>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/docs/n9e/code/" class="collapsed ">n9e源码学golang</a>
  

          
  
  
  

  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
    <a href="/docs/compose/" class="">编排</a>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/docs/compose/ansible/" class="collapsed ">ansible</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/compose/terraform/" class="collapsed ">terraform</a>
  

          
  
  
  

  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
    <a href="/docs/golang/" class="">golang</a>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/docs/golang/leetcode/" class="collapsed ">leetcode</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/golang/posts/circuit-breaker/" class="">hytrix-go</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/golang/posts/golang-gateway/" class="">golang实现简单网关</a>
  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
    <a href="/docs/about-me/" class="">关于我</a>
  

          
  
  
  

  
  <ul>
    
  </ul>
  

        </li>
      
    
  </ul>
  











  
<ul>
  
  <li>
    <a href="/posts/" >
        博客
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>ogg</strong>

  <label for="toc-control">
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
  </label>
</div>


  
    <input type="checkbox" class="hidden" id="toc-control" />
    <aside class="hidden clearfix">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#1-需求">1. 需求</a></li>
    <li><a href="#2-方案">2. 方案</a>
      <ul>
        <li><a href="#21-使用ogg推荐">2.1. 使用ogg（推荐）</a></li>
        <li><a href="#22-使用canal">2.2. 使用canal</a></li>
      </ul>
    </li>
    <li><a href="#3-ogg的安装部署mysql">3. ogg的安装部署（MySQL）</a>
      <ul>
        <li><a href="#31-准备材料">3.1. 准备材料</a></li>
        <li><a href="#32-安装测试mysql">3.2. 安装测试MySQL</a></li>
        <li><a href="#33-安装zookeeper以及kafka">3.3. 安装zookeeper以及kafka</a></li>
        <li><a href="#34-安装ogg">3.4. 安装ogg</a></li>
        <li><a href="#35-配置ogg-mysql">3.5. 配置ogg-mysql</a></li>
        <li><a href="#36-配置ogg-target">3.6. 配置ogg-target</a></li>
        <li><a href="#37-启动并测试">3.7. 启动并测试</a></li>
      </ul>
    </li>
  </ul>
</nav>


    </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="ogg">ogg</h1>
<p><code>ogg</code>全名<code>Oracle GoldenGate</code>，是Oracle公司用于同步数据库的工具。</p>
<h2 id="1-需求">1. 需求</h2>
<p>监听源数据库MySQL/Oracle，将DML事件发送到Kafka中。</p>
<h2 id="2-方案">2. 方案</h2>
<h3 id="21-使用ogg推荐">2.1. 使用ogg（推荐）</h3>
<p>ogg支持MySQL和Oracle，将DML同步到kafka中，提供给后端使用。</p>
<h3 id="22-使用canal">2.2. 使用canal</h3>
<p>canal是阿里开源的数据库同步/迁移工具，目前仅支持MySQL作为源数据库；对于Oracle，可以使用yugong同步到MySQL中，然后再基于canal进行binlog解析，最后同步到kafka中。</p>
<h2 id="3-ogg的安装部署mysql">3. ogg的安装部署（MySQL）</h2>
<h3 id="31-准备材料">3.1. 准备材料</h3>
<ul>
<li><a href="https://www.oracle.com/middleware/technologies/goldengate-downloads.html">下载ogg二进制包</a>
<ul>
<li>Oracle GoldenGate for Big Data 19.1.0.0.1 on Linux x86-64</li>
<li>Oracle GoldenGate 19.1.0.0.3 for MySQL on Linux x86-64</li>
</ul>
</li>
<li>centos7
<ul>
<li>ogg-mysql(10.41.253.211)</li>
<li>ogg-target(10.41.253.212)</li>
</ul>
</li>
<li>JDK 1.8
<ul>
<li>/usr/local/jdk</li>
</ul>
</li>
</ul>
<h3 id="32-安装测试mysql">3.2. 安装测试MySQL</h3>
<p><strong>ubuntu</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># 安装</span>
$ apt install mysql-server-5.7 -y
<span style="color:#75715e"># 简单配置</span>
$ mysql_secure_installation
<span style="color:#75715e"># 添加binlog配置</span>
$ grep -E <span style="color:#e6db74">&#34;^(server-id|log_bin|binlog_format)&#34;</span> /etc/mysql/mysql.conf.d/mysqld.cnf
server-id		<span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
log_bin			<span style="color:#f92672">=</span> /var/log/mysql/mysql-bin.log
binlog_format	<span style="color:#f92672">=</span>	row
$ mkdir /var/log/mysql <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span> chown mysql:mysql -R /var/log/mysql
 $ systemctl restart mysqld
</code></pre></div><p><strong>centos7</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># 配置源</span>
$ cd /tmp <span style="color:#f92672">&amp;&amp;</span> wget https://dev.mysql.com/get/mysql57-community-release-el7-9.noarch.rpm <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  rpm -i mysql57-community-release-el7-9.noarch.rpm
<span style="color:#75715e"># 安装mysql</span>
$ yum install mysql-server -y
<span style="color:#75715e"># 启动mysql</span>
$ systemctl start mysqld
<span style="color:#75715e"># 获取root密码</span>
$ grep <span style="color:#e6db74">&#39;temporary password&#39;</span> /var/log/mysqld.log
<span style="color:#75715e"># 初始化配置</span>
$ mysql_secure_installation
</code></pre></div><p><strong>建立测试库表</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> data <span style="color:#66d9ef">CHARSET</span> utf8;

<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#f92672">`</span>data<span style="color:#f92672">`</span>.<span style="color:#f92672">`</span>t1<span style="color:#f92672">`</span> (
  <span style="color:#f92672">`</span>id<span style="color:#f92672">`</span> <span style="color:#66d9ef">int</span>(<span style="color:#ae81ff">11</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">AUTO_INCREMENT</span>,
  <span style="color:#f92672">`</span>name<span style="color:#f92672">`</span> <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">60</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> (<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span>)
) <span style="color:#66d9ef">ENGINE</span><span style="color:#f92672">=</span>InnoDB <span style="color:#66d9ef">AUTO_INCREMENT</span><span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">CHARSET</span><span style="color:#f92672">=</span>utf8;

<span style="color:#75715e"># ogg 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">user</span> <span style="color:#e6db74">&#39;ogg&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span> <span style="color:#66d9ef">identified</span> <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;Ogg.123456&#39;</span>;
<span style="color:#66d9ef">grant</span> <span style="color:#66d9ef">select</span> <span style="color:#66d9ef">on</span> data.<span style="color:#f92672">*</span> <span style="color:#66d9ef">to</span> <span style="color:#e6db74">&#39;ogg&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span>;
<span style="color:#75715e"># mng
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">user</span> <span style="color:#e6db74">&#39;root&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span> <span style="color:#66d9ef">identified</span> <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;Ogg.123456&#39;</span>;
<span style="color:#66d9ef">grant</span> <span style="color:#66d9ef">all</span> <span style="color:#66d9ef">privileges</span> <span style="color:#66d9ef">on</span> <span style="color:#f92672">*</span>.<span style="color:#f92672">*</span> <span style="color:#66d9ef">to</span> <span style="color:#e6db74">&#39;ogg&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span>;
<span style="color:#66d9ef">flush</span> <span style="color:#66d9ef">privileges</span>;
</code></pre></div><h3 id="33-安装zookeeper以及kafka">3.3. 安装zookeeper以及kafka</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">bin/zookeeper-server-start.sh -daemon config/zookeeper.properties
bin/kafka-server-start.sh -daemon config/server.properties
</code></pre></div><h3 id="34-安装ogg">3.4. 安装ogg</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># base /opt/ogg</span>

<span style="color:#75715e"># /etc/profile</span>
export OGG_HOME<span style="color:#f92672">=</span>/opt/ogg
export PATH<span style="color:#f92672">=</span>$OGG_HOME:$PATH
export LD_LIBRARY_PATH<span style="color:#f92672">=</span>$OGG_HOME:$JAVA_HOME/jre/lib/amd64/server:$LD_LIBRARY_PATH
</code></pre></div><h3 id="35-配置ogg-mysql">3.5. 配置ogg-mysql</h3>
<h4 id="351-初始化目录">3.5.1. 初始化目录</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">oggsci<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">create</span> subdirs
</code></pre></div><h4 id="352-配置启动mgr进程">3.5.2. 配置启动mgr进程</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">oggsci<span style="color:#f92672">&gt;</span> edit param mgr

port <span style="color:#ae81ff">7809</span>
dynamicportlist <span style="color:#ae81ff">7840</span><span style="color:#f92672">-</span><span style="color:#ae81ff">7939</span>
autorestart er <span style="color:#f92672">*</span>, retries <span style="color:#ae81ff">5</span>, waitminutes <span style="color:#ae81ff">3</span>
purgeoldextracts <span style="color:#f92672">/</span>opt<span style="color:#f92672">/</span>ogg<span style="color:#f92672">/</span>dirdat<span style="color:#75715e">/*,usecheckpoints, minkeepdays 7
</span><span style="color:#75715e">
</span><span style="color:#75715e">oggsci&gt; start mgr
</span><span style="color:#75715e">oggsci&gt; info mgr
</span></code></pre></div><ul>
<li>port: 进程的默认监听端口</li>
<li>dynamicportlist：动态端口列表</li>
<li>autorestart：重启参数，配置重启所有extract进程</li>
<li>purgeoldextracts：TRAIL文件的定期清理策略</li>
</ul>
<h4 id="353-配置启动extract进程">3.5.3. 配置启动extract进程</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">oggsci<span style="color:#f92672">&gt;</span> edit param extmysql

<span style="color:#66d9ef">extract</span> extmysql
sourcedb <span style="color:#66d9ef">data</span><span style="color:#f92672">@</span>ogg<span style="color:#f92672">-</span>mysql:<span style="color:#ae81ff">3306</span> userid ogg password Ogg.<span style="color:#ae81ff">123456</span>
exttrail <span style="color:#f92672">/</span>opt<span style="color:#f92672">/</span>ogg<span style="color:#f92672">/</span>dirdat<span style="color:#f92672">/</span>om
TranLogOptions AltLogDest <span style="color:#f92672">/</span>var<span style="color:#f92672">/</span>log<span style="color:#f92672">/</span>mysql<span style="color:#f92672">/</span>mysql<span style="color:#f92672">-</span>bin.<span style="color:#66d9ef">index</span>
<span style="color:#66d9ef">table</span> <span style="color:#66d9ef">data</span>.t1;

<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">添加</span><span style="color:#66d9ef">extract</span>
oggsci<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">extract</span> extmysql,tranlog,<span style="color:#66d9ef">begin</span> now
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">绑定</span>extract和trail
oggsci<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">add</span> exttrail <span style="color:#f92672">/</span>opt<span style="color:#f92672">/</span>ogg<span style="color:#f92672">/</span>dirdat<span style="color:#f92672">/</span>om,<span style="color:#66d9ef">extract</span> extmysql

</code></pre></div><h4 id="354-配置传输pump进程">3.5.4. 配置传输pump进程</h4>
<pre><code>oggsci&gt; edit param pumpcp

extract pumpcp
passthru
sourcedb data@ogg-mysql:3306 userid ogg password Ogg.123456
rmthost  ogg-target,mgrport 7809,compress
rmttrail  /opt/ogg/dirdat/om
dynamicresolution
numfiles 3000
table data.t1;

# 分别添加本地trail文件和目标端trail文件绑定到mcp1进程
oggsci&gt; add extract pumpcp,exttrailsource /opt/ogg/dirdat/om
oggsci&gt; add rmttrail /opt/ogg/dirdat/om,extract pumpcp
</code></pre><h4 id="355-创建定义文件">3.5.5. 创建定义文件</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">ggsci<span style="color:#f92672">&gt;</span> edit param defgen

defsfile .<span style="color:#f92672">/</span>dirdef<span style="color:#f92672">/</span>datat1.def
sourcedb <span style="color:#66d9ef">data</span><span style="color:#f92672">@</span>ogg<span style="color:#f92672">-</span>mysql:<span style="color:#ae81ff">3306</span> userid ogg password Ogg.<span style="color:#ae81ff">123456</span>
<span style="color:#66d9ef">table</span> <span style="color:#66d9ef">data</span>.t1;
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ defgen paramfile ./dirprm/defgen.prm
$ scp ./dirdef/datat1.def ogg-target:/ogg/dirdef/
</code></pre></div><h3 id="36-配置ogg-target">3.6. 配置ogg-target</h3>
<h4 id="361-初始化目录">3.6.1. 初始化目录</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">oggsci<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">create</span> subdirs
</code></pre></div><h4 id="362-配置启动mgr进程">3.6.2. 配置启动mgr进程</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">oggsci<span style="color:#f92672">&gt;</span> edit param mgr

port <span style="color:#ae81ff">7809</span>
dynamicportlist <span style="color:#ae81ff">7840</span><span style="color:#f92672">-</span><span style="color:#ae81ff">7939</span>
autorestart er <span style="color:#f92672">*</span>, retries <span style="color:#ae81ff">5</span>, waitminutes <span style="color:#ae81ff">3</span>
purgeoldextracts <span style="color:#f92672">/</span>opt<span style="color:#f92672">/</span>ogg<span style="color:#f92672">/</span>dirdat<span style="color:#75715e">/*,usecheckpoints, minkeepdays 7
</span><span style="color:#75715e">
</span><span style="color:#75715e">oggsci&gt; start mgr
</span><span style="color:#75715e">oggsci&gt; info mgr
</span></code></pre></div><h4 id="363-配置replicat进程">3.6.3. 配置replicat进程</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">oggsci<span style="color:#f92672">&gt;</span> edit param repkfk

REPLICAT repkfk
sourcedefs <span style="color:#f92672">/</span>opt<span style="color:#f92672">/</span>ogg<span style="color:#f92672">/</span>dirdef<span style="color:#f92672">/</span>datat1.def
TARGETDB LIBFILE libggjava.so <span style="color:#66d9ef">SET</span> property<span style="color:#f92672">=</span>dirprm<span style="color:#f92672">/</span>kafka.props
REPORTCOUNT <span style="color:#66d9ef">EVERY</span> <span style="color:#ae81ff">1</span> MINUTES, RATE 
GROUPTRANSOPS <span style="color:#ae81ff">10000</span>
<span style="color:#66d9ef">MAP</span> <span style="color:#66d9ef">data</span>.t1, TARGET <span style="color:#66d9ef">data</span>.t1;

oggsci<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">add</span> replicat repkfk exttrail <span style="color:#f92672">/</span>opt<span style="color:#f92672">/</span>ogg<span style="color:#f92672">/</span>dirdat<span style="color:#f92672">/</span>om,checkpointtable ogg<span style="color:#f92672">-</span>mapping<span style="color:#f92672">-</span>tmpl.<span style="color:#66d9ef">checkpoint</span>
</code></pre></div><p><strong>kafka.props</strong></p>
<pre><code class="language-properties" data-lang="properties">gg.handlerlist=kafkahandler
gg.handler.kafkahandler.type=kafka
gg.handler.kafkahandler.KafkaProducerConfigFile=custom_kafka_producer.properties
gg.handler.kafkahandler.topicMappingTemplate=${tableName}
gg.handler.kafkahandler.keyMappingTemplate=${primaryKeys}
gg.handler.kafkahandler.SchemaTopicName=ogg-schema
gg.handler.kafkahandler.format=json
gg.handler.kafkahandler.mode=op
gg.classpath=/usr/local/kafka/libs/*
</code></pre><p><strong>custom_kafka_producer.properties</strong></p>
<pre><code class="language-properties" data-lang="properties">bootstrap.servers=localhost:9092
acks=1
reconnect.backoff.ms=1000

value.serializer=org.apache.kafka.common.serialization.ByteArraySerializer
key.serializer=org.apache.kafka.common.serialization.ByteArraySerializer

batch.size=16384
linger.ms=200
</code></pre><h3 id="37-启动并测试">3.7. 启动并测试</h3>
<ol>
<li>ogg-mysql -&gt; start mgr</li>
<li>ogg-mysql -&gt; start extract</li>
<li>ogg-target -&gt; start mgr</li>
<li>ogg-mysql -&gt; start pump</li>
<li>ogg-mysql -&gt; start replicat</li>
</ol>
<p><strong>监听kafka队列</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic t1 --from-beginning

<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;table&#34;</span>:<span style="color:#e6db74">&#34;data.t1&#34;</span>,<span style="color:#e6db74">&#34;op_type&#34;</span>:<span style="color:#e6db74">&#34;U&#34;</span>,<span style="color:#e6db74">&#34;op_ts&#34;</span>:<span style="color:#e6db74">&#34;2020-07-08 20:18:21.000390&#34;</span>,<span style="color:#e6db74">&#34;current_ts&#34;</span>:<span style="color:#e6db74">&#34;2020-07-08T20:18:27.673000&#34;</span>,<span style="color:#e6db74">&#34;pos&#34;</span>:<span style="color:#e6db74">&#34;00000000000000003260&#34;</span>,<span style="color:#e6db74">&#34;before&#34;</span>:<span style="color:#f92672">{}</span>,<span style="color:#e6db74">&#34;after&#34;</span>:<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;ID&#34;</span>:3,<span style="color:#e6db74">&#34;NAME&#34;</span>:<span style="color:#e6db74">&#34;luoshuai1&#34;</span><span style="color:#f92672">}}</span>
</code></pre></div></article>
 
      

      <footer class="book-footer">
        
  <div class="flex justify-between">





</div>

 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#1-需求">1. 需求</a></li>
    <li><a href="#2-方案">2. 方案</a>
      <ul>
        <li><a href="#21-使用ogg推荐">2.1. 使用ogg（推荐）</a></li>
        <li><a href="#22-使用canal">2.2. 使用canal</a></li>
      </ul>
    </li>
    <li><a href="#3-ogg的安装部署mysql">3. ogg的安装部署（MySQL）</a>
      <ul>
        <li><a href="#31-准备材料">3.1. 准备材料</a></li>
        <li><a href="#32-安装测试mysql">3.2. 安装测试MySQL</a></li>
        <li><a href="#33-安装zookeeper以及kafka">3.3. 安装zookeeper以及kafka</a></li>
        <li><a href="#34-安装ogg">3.4. 安装ogg</a></li>
        <li><a href="#35-配置ogg-mysql">3.5. 配置ogg-mysql</a></li>
        <li><a href="#36-配置ogg-target">3.6. 配置ogg-target</a></li>
        <li><a href="#37-启动并测试">3.7. 启动并测试</a></li>
      </ul>
    </li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  
</body>

</html>












